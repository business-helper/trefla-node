const _0x2955=['B3b0Aw9UCW','zgv2AwnLx3rVA2vU','vhjHBNnMzxiGCMvXDwvZDgvYigHHCYbIzwvUigrLBgv0zwqH','ugfZC3DVCMqGzg9LCYbUB3qGBwf0y2GH','Dw5IBg9JA1vZzxi','z2v0qNLjzhm','C3rYAw5N','zMLSDgvY','BwvZC2fNzq','BgfZDe1Zz0LKt25uCMfUC2zLCG','z2vUzxjHDgvsyw5KB21tDhjPBMC','vxnLCIbKB2vZBID0igHHDMuGy2fYzcbPBMzVCM1HDgLVBIe','jvvZzxjUyw1Ljq','z2v0qNLdyxjK','Bg9JyxrPB25FyxjYyxK','mJuYmtnjt0fKvMO','DxnLCL9Uyw1L','C3rYAw5NAwz5','w0LeihrYyw5ZzMvYxsbZyw1LigLKihDPDgGGBgfZDcbVD25LCIe','y2fYzfrYyw5ZzMvYuMvXDwvZDefJy2vWDe5VDgLuExbL','lI4VBw9KzwXZl2vTywLSvgvTCgXHDguUBw9KzwW','zgvSzxrLqNLjza','y3jLyxrLvMvYAwz5swrszxe','B2jQzwn0','y2fYzfbHz2LUyxrPB24','C3bSAxq','DxbKyxrLqNLjza','CxvLCNK','DxnLCG','DMfS','y2f0y2G','zM9Yz290ugfZC3DVCMq','ww91ihvUyMXVy2TLzcaN','lI4VAgvSCgvYCW','BgfZDe1Zz0LUq2HHDa','zw1HAwW','CMvWBhK','yxbW','u0Tux0Xuu19tsu5hteu','Cg9ZDa','u0Tux0jmt0nlx0jmt0nlruq','vxnLCIbOyxmGyMvLBIb1BNzLCMLMAwvKiq','lI4Vy29UC3rHBNrZl25VDgLMAwnHDgLVBI5JB25ZDgfUDa','zMfPBgvK','Bg9JyxrPB25FyxjLyq','Bg9NAw5FBw9Kzq','oti2mtiYDuHxCMTv','ANnVBG','ywXS','CMvJzwL2zxjFAwq','vxnLCIbKB2vZig5VDcbLEgLZDce','A2v5CW','zgvSzxrLqNLjzfjLCq','zw1PDa','odG4odHwBuXtyNm','z2vUzxjHDgvoB3rPzMLJyxrPB25eyxrH','CgfNzq','BgvUz3rO','CgfZC3DVCMq','ywrTAw5oB3rPzMLJyxrPB24','vKvssuzzx0Le','u0Tux0niqvrmsvnux1vqrefuruq','odC4mJy3yxPsugrk','tK9stufm','C29JA2v0x2LK','Aw5JBhvKzxm','CMvZzxrqyxnZD29Yza','y2fYzfzLCMLMEvjLCxvLC3rby2nLChroB3rPvhLWzq','Bw9Kzq','y2fYzf9UDw1Izxi','lI4VAgvSCgvYCY9JB21TB24UAgvSCgvYCW','w2nOyxrSAxn0xq','BgLTAxq','zgvSzxrLvhjHBNnMzxjszxf1zxn0','Aw5KzxHpzG','DxbKyxrLuMvJzwL2zxjjBKnHCMrdAgf0','DgHLBG','y29Kzq','BNvTyMvYt2zdyxjK','C29JA2v0q2XPzw50','C3vJy2vZCW','lI4Vy29UC3rHBNrZl3nVy2TLDc5JB25ZDgfUDa','BgfZDf9TzxnZywDLCW','y2fYzf9PBwDFDxjS','ww91igDVDcb1BMjSB2nRzwqH','zM9YrwfJAa','y2fYzf92zxjPzMLLza','Bw9KzwW','Dg9tDhjPBMC','y29TBwvUDa','Bg9N','BwvZC2fNzuLK','CgfYC2u','w2nOyxqUBgLZDc51CgrHDgvKxsaTls0+','mtDbuNjxDfe','mvbovNHvsG','v2uGCMvJzwL2zwqGEw91CIbYzxf1zxn0iq','C3bSAwnL','Dw52zxjPzNLdAgf0C0j5q2fYza','BNvTyMvYt2zvC2vYCW','jwnVzguL','zw1HAwXFDxnLCM5HBwu','Dw52zxjPzNLvC2vYuMvX','zgvSzxrLqNLvC2vY','yM9KEq','lI4VAgvSCgvYCY9HDxrOlMHLBhbLCNm','Bg9NAw4','C2vUzgvYx2LK','B3b0Aw9UywW','w2nOyxqGBgLZDf0GihjLBw92zwq','u0Tux0nbuKrFvKvssuzjruq','odC0mJbTALHZvxm','BM90AwzPy2f0Aw9U','CMvWBhLuB1rYyw5ZzMvYuMvXDwvZDa','yMXVy2TvC2vY','DMvYAwz5vxnLCLjLCq','rMfPBgvKihrVigrLBgv0zsb1C2vYiq','CMvWBgfJzq','DxbKyxrLuhjVzMLSzq','y2fYzfrYyw5ZzMvYuMvXDwvZDfjLAMn0tM90Avr5Cgu','w1bYB2nLC3mGy2fYzcbJAgf0C10GzxjYB3i','z2v0qNLvC2vYtMfTzq','u0Tux05pveLFtLvnx1vqrefuruq','yxnZAwDU','ChvZAa','lI4VBw9KzwXZl3vZzxiUBw9KzwW','ufjprKLmrq','DxnLCL9Pzhm','z2vUzxjHDgvbzg1PBK5VDgLeyxrH','CgfYyw1Z','BwfW','vgHHBMSGEw91isbxzsb3AwXSigDLDcbIywnRihrVihLVDsbZB29UlG','tM8GDMfSAwqGy2fYzcbUDw1IzxiGzM91BMqH','yMXHy2TFBgLZDa','ww91igDVDcbIBg9JA2vKiq','DhjLzMXHidXHzg1PBKb0CMvMBgeUy29TpG','CgfNAw5HDgLVBG','y2fYzfrYyw5ZzMvYuMvXDwvZDe5VDgLuExbL','B3b0Aw9UywXFDMfS','zM9Yz290x3bHC3n3B3jK','C2f2zq','z2vUzxjHDgvvC2vYBMfTzq','Bg9JywXZ','z2v0qNLfBwfPBa','z2v0q2HHDfrVq2fYza','y2fYzfzLCMLMEvjLCxvLC3rszwPLy3roB3rPvhLWzq','mty4ndK5re51CvDK','BM90Av9UDw0','z2v0qNLjzgvUDgLMAwvY','z2v0uhjVzMLSzq','yMfUuMvWBhLszxe','B3v0Chv0','y29TBw9U','ww91igjSB2nRzwqGjW','sLnptLbHCNnLCG','w2nOyxqGBgLZDf0GigfKzgvK','vxnLCIbOyxmGyMvLBIb1CgrHDgvKiq','z2v0qNLjza','ntyWodq5DMHAsg9n','ww91ihjLCxvLC3qGAgfZigjLzw4GCMvJzwL2zwqH','y3jLyxrL','CMvJB3zLCNLFy29Kzq','y2HHDa','w3zLCMLMEwLUzYb1C2vYxq'];const _0x3ff3=function(_0x173f41,_0xf2ec59){_0x173f41=_0x173f41-0x154;let _0x2955d2=_0x2955[_0x173f41];if(_0x3ff3['rxnkAc']===undefined){var _0x3ff3c0=function(_0x5b0b80){const _0x54ad8b='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x26795c='';for(let _0x171f00=0x0,_0xe079db,_0x5702e7,_0x26e74b=0x0;_0x5702e7=_0x5b0b80['charAt'](_0x26e74b++);~_0x5702e7&&(_0xe079db=_0x171f00%0x4?_0xe079db*0x40+_0x5702e7:_0x5702e7,_0x171f00++%0x4)?_0x26795c+=String['fromCharCode'](0xff&_0xe079db>>(-0x2*_0x171f00&0x6)):0x0){_0x5702e7=_0x54ad8b['indexOf'](_0x5702e7);}return _0x26795c;};_0x3ff3['ffRoma']=function(_0x46ff35){const _0x4f029e=_0x3ff3c0(_0x46ff35);let _0x10f840=[];for(let _0x4d4e5d=0x0,_0x43071c=_0x4f029e['length'];_0x4d4e5d<_0x43071c;_0x4d4e5d++){_0x10f840+='%'+('00'+_0x4f029e['charCodeAt'](_0x4d4e5d)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x10f840);},_0x3ff3['GBVQsk']={},_0x3ff3['rxnkAc']=!![];}const _0x451cec=_0x2955[0x0],_0xe07f9d=_0x173f41+_0x451cec,_0x5e7324=_0x3ff3['GBVQsk'][_0xe07f9d];return _0x5e7324===undefined?(_0x2955d2=_0x3ff3['ffRoma'](_0x2955d2),_0x3ff3['GBVQsk'][_0xe07f9d]=_0x2955d2):_0x2955d2=_0x5e7324,_0x2955d2;};const _0x5d33b3=_0x3ff3;(function(_0x1b58f2,_0x15e2a1){const _0x501717=_0x3ff3;while(!![]){try{const _0x26f742=parseInt(_0x501717(0x19b))+-parseInt(_0x501717(0x167))+parseInt(_0x501717(0x15b))*-parseInt(_0x501717(0x1cc))+-parseInt(_0x501717(0x1a3))+parseInt(_0x501717(0x17c))*-parseInt(_0x501717(0x1cb))+parseInt(_0x501717(0x1ab))+-parseInt(_0x501717(0x1dc));if(_0x26f742===_0x15e2a1)break;else _0x1b58f2['push'](_0x1b58f2['shift']());}catch(_0x1a62a9){_0x1b58f2['push'](_0x1b58f2['shift']());}}}(_0x2955,0x72c60));const {Validator}=require('node-input-validator'),CONSTS=require(_0x5d33b3(0x1be)),NOTI_TYPES=require(_0x5d33b3(0x197)),{LOGIN_MODE}=require('../constants/common.constant'),{ADMIN_NOTI_TYPES}=require(_0x5d33b3(0x197)),models=require('../models/index'),User=require(_0x5d33b3(0x1ea)),helpers=require(_0x5d33b3(0x18e)),EmailTemplate=require(_0x5d33b3(0x181)),{generateTZTimeString,JSONParser,JSONStringify,respondError,sendMail}=require(_0x5d33b3(0x1b3)),{comparePassword,generateUserData,genreateAuthToken,generatePassword,getTokenInfo}=require(_0x5d33b3(0x1d6));exports['register']=async(_0x451cec,_0xe07f9d)=>{const _0x48c750=_0x5d33b3;let _0x5e7324=null,_0x5b0b80;_0x5b0b80=_0x451cec[_0x48c750(0x1d5)][_0x48c750(0x1b2)]||'';let _0x54ad8b=![],_0x26795c=0x0;_0x5b0b80&&([_0x5e7324]=await models[_0x48c750(0x189)][_0x48c750(0x17a)](_0x5b0b80,0x1),_0x5e7324&&(_0x54ad8b=!![],_0x26795c=_0x5e7324['id']));const _0x171f00=generateUserData({..._0x451cec[_0x48c750(0x1d5)],'card_number':_0x5e7324?'':_0x5b0b80});return generatePassword(_0x171f00[_0x48c750(0x1a7)])[_0x48c750(0x1b9)](_0xe079db=>{const _0x20e632=_0x48c750;return _0x451cec['body'][_0x20e632(0x19a)]!==LOGIN_MODE[_0x20e632(0x1ac)]&&Object[_0x20e632(0x1a0)](LOGIN_MODE)[_0x20e632(0x1ae)](_0x451cec['body'][_0x20e632(0x19a)])?{..._0x171f00,'password':'','social_pass':JSON[_0x20e632(0x17e)]({[_0x451cec[_0x20e632(0x1d5)][_0x20e632(0x19a)]]:_0xe079db})}:(_0x451cec[_0x20e632(0x1d5)][_0x20e632(0x19a)]=LOGIN_MODE[_0x20e632(0x1ac)],{..._0x171f00,'password':_0xe079db});})[_0x48c750(0x1b9)](async _0x5702e7=>{const _0x11d773=_0x48c750;return User[_0x11d773(0x169)](_0x5702e7);})[_0x48c750(0x1b9)](async _0x26e74b=>{const _0x524507=_0x48c750;if(_0x5b0b80&&!_0x5e7324){let _0x46ff35=[];await models[_0x524507(0x16b)]['getChatToCard']({'card_number':_0x26e74b[_0x524507(0x1b2)]})[_0x524507(0x1b9)](_0x4f029e=>{const _0x232aa8=_0x524507;_0x46ff35=_0x4f029e;const _0x10f840=_0x4f029e[_0x232aa8(0x1ef)](_0x4d4e5d=>{const _0x43071c=JSON['parse'](_0x4d4e5d['user_ids']);return _0x43071c[0x0];});return User[_0x232aa8(0x172)](_0x10f840);})[_0x524507(0x1b9)](_0x29b5a0=>{const _0x251195=_0x524507,_0x4df1a0=_0x451cec[_0x251195(0x192)][_0x251195(0x157)][_0x251195(0x1bc)];_0x29b5a0[_0x251195(0x1c2)]((_0x39a7f3,_0x400c6a)=>{const _0x3447f2=_0x251195;_0x39a7f3[_0x3447f2(0x1ad)]&&_0x4df1a0[_0x3447f2(0x1a2)](CONSTS[_0x3447f2(0x193)],{'to':_0x39a7f3['socket_id'],'event':CONSTS['SKT_REGISTER_WITH_CARD'],'args':{'chat':{...models[_0x3447f2(0x16b)][_0x3447f2(0x160)](_0x46ff35[_0x400c6a]),'user':models['user'][_0x3447f2(0x160)](_0x26e74b)}}});});});}return Promise[_0x524507(0x19d)]([_0x26e74b,genreateAuthToken(_0x26e74b)]);})[_0x48c750(0x1b9)](([_0x20caa4,_0xa67134])=>_0xe07f9d['json']({'status':!![],'message':'success','data':User[_0x48c750(0x160)](_0x20caa4,_0x48c750(0x1eb)),'token':_0xa67134,'cardVerified':{'exists':_0x54ad8b,'user_id':_0x26795c}}));},exports[_0x5d33b3(0x1d7)]=(_0x18bbf1,_0x469d87)=>{const _0x491446=_0x5d33b3;return Promise[_0x491446(0x19d)]([User[_0x491446(0x158)](_0x18bbf1['body'][_0x491446(0x1d2)]),User[_0x491446(0x1e6)](_0x18bbf1[_0x491446(0x1d5)][_0x491446(0x1d2)])])['then'](async([_0x17654c,_0x2a977d])=>{const _0x1d67b7=_0x491446,_0x1227d6=_0x17654c||_0x2a977d;let _0x3f5f65;if(_0x18bbf1[_0x1d67b7(0x1d5)]['login_mode']===LOGIN_MODE[_0x1d67b7(0x1ac)])_0x3f5f65=_0x1227d6[_0x1d67b7(0x1a7)];else{const _0x355fbe=JSON[_0x1d67b7(0x1c9)](_0x1227d6['social_pass']);_0x3f5f65=_0x355fbe[_0x18bbf1[_0x1d67b7(0x1d5)][_0x1d67b7(0x19a)]],_0x3f5f65===undefined&&(_0x1227d6['social_pass']=JSON[_0x1d67b7(0x17e)]({..._0x355fbe,[_0x18bbf1[_0x1d67b7(0x1d5)][_0x1d67b7(0x19a)]]:await generatePassword(_0x18bbf1[_0x1d67b7(0x1d5)][_0x1d67b7(0x1a7)])}));}if(_0x18bbf1[_0x1d67b7(0x1d5)][_0x1d67b7(0x16e)])_0x1227d6[_0x1d67b7(0x16e)]=_0x18bbf1['body']['device_token'];if(_0x18bbf1[_0x1d67b7(0x1d5)][_0x1d67b7(0x199)])_0x1227d6[_0x1d67b7(0x199)]=_0x18bbf1[_0x1d67b7(0x1d5)]['location_area'];return Promise[_0x1d67b7(0x19d)]([_0x1227d6,_0x18bbf1[_0x1d67b7(0x1d5)][_0x1d67b7(0x19a)]!==LOGIN_MODE[_0x1d67b7(0x1ac)]&&!_0x3f5f65?!![]:comparePassword(_0x18bbf1[_0x1d67b7(0x1d5)][_0x1d67b7(0x1a7)],_0x3f5f65),genreateAuthToken(_0x1227d6),User[_0x1d67b7(0x155)](_0x1227d6)]);})[_0x491446(0x1b9)](([_0x3bb37f,_0x11b8c6,_0x28c4be,_0x4a417b])=>{const _0x2140c0=_0x491446;return _0x11b8c6?_0x469d87[_0x2140c0(0x19c)]({'status':!![],'message':_0x2140c0(0x1bd),'data':User[_0x2140c0(0x160)](_0x4a417b,_0x2140c0(0x1eb)),'token':_0x28c4be}):_0x469d87['status'](0x190)['json']({'status':![],'message':_0x2140c0(0x170)});})[_0x491446(0x18b)](_0x130c4d=>respondError(_0x469d87,_0x130c4d));},exports[_0x5d33b3(0x18c)]=(_0x4d54d1,_0x31b950)=>{const _0x3996ae=_0x5d33b3;return Promise['all']([User[_0x3996ae(0x158)](_0x4d54d1[_0x3996ae(0x1d5)][_0x3996ae(0x190)]),EmailTemplate[_0x3996ae(0x15d)](_0x3996ae(0x154))])[_0x3996ae(0x1b9)](([_0x5b6bd2,_0x1764cd])=>{const _0x32c002=_0x3996ae,_0x477578=_0x1764cd[_0x32c002(0x1d5)][_0x32c002(0x1e2)](new RegExp(_0x32c002(0x179)),_0x5b6bd2[_0x32c002(0x17d)])[_0x32c002(0x1e2)](new RegExp(_0x32c002(0x1d1)),_0x4d54d1['body'][_0x32c002(0x1ba)]);return Promise[_0x32c002(0x19d)]([sendMail({'from':_0x32c002(0x1f4),'to':_0x5b6bd2[_0x32c002(0x190)],'subject':_0x1764cd['subject'],'body':_0x477578}),User[_0x32c002(0x155)]({..._0x5b6bd2,'recovery_code':_0x4d54d1[_0x32c002(0x1d5)][_0x32c002(0x1ba)]})]);})['then'](([_0x541d1c,_0x23c143])=>{const _0x2fd75c=_0x3996ae;return _0x541d1c&&_0x541d1c['messageId']?_0x31b950['json']({'status':!![],'message':'success','data':{'code':_0x4d54d1['body']['code'],'messageId':_0x541d1c[_0x2fd75c(0x1c8)]}}):_0x31b950[_0x2fd75c(0x19c)]({'status':![],'message':_0x2fd75c(0x198),'data':_0x541d1c});})[_0x3996ae(0x18b)](_0x4c4d2b=>respondError(_0x31b950,_0x4c4d2b));},exports[_0x5d33b3(0x1af)]=(_0x533a55,_0x5e4fea)=>{const _0x2f3a76=_0x5d33b3;return Promise[_0x2f3a76(0x19d)]([User[_0x2f3a76(0x158)](_0x533a55['body']['email']),generatePassword(_0x533a55[_0x2f3a76(0x1d5)][_0x2f3a76(0x1a7)])])[_0x2f3a76(0x1b9)](([_0x3e50b8,_0x514f17])=>{const _0xb92484=_0x2f3a76;if(_0x3e50b8[_0xb92484(0x16a)]!==_0x533a55[_0xb92484(0x1d5)]['code'])throw Object[_0xb92484(0x1e8)](new Error('Recovery\x20code\x20does\x20not\x20match!'),{'code':0x190});else return _0x3e50b8[_0xb92484(0x1a7)]=_0x514f17,_0x3e50b8['recovery_code']='',User[_0xb92484(0x155)](_0x3e50b8);})['then'](_0x381199=>_0x5e4fea[_0x2f3a76(0x19c)]({'status':!![],'message':'success'}))['catch'](_0x561bd9=>respondError(_0x5e4fea,_0x561bd9));},exports[_0x5d33b3(0x166)]=(_0x4850b1,_0xbcae7d)=>{const _0x5ab926=_0x5d33b3,{id:_0x100e68}=_0x4850b1[_0x5ab926(0x1ee)];return User['getById'](_0x100e68)[_0x5ab926(0x1b9)](_0x4e3d81=>{const _0x1e8f4b=_0x5ab926;return _0x4e3d81=User[_0x1e8f4b(0x160)](_0x4e3d81,_0x1e8f4b(0x1eb)),_0xbcae7d[_0x1e8f4b(0x19c)]({'status':!![],'message':'success','data':_0x4e3d81});})[_0x5ab926(0x18b)](_0x36a5c6=>respondError(_0xbcae7d,_0x36a5c6));},exports[_0x5d33b3(0x15e)]=(_0x32fb6c,_0x24f25b)=>{const _0x4b647c=_0x5d33b3,{uid:_0x5a7795}=getTokenInfo(_0x32fb6c);return User['getById'](_0x5a7795)[_0x4b647c(0x1b9)](_0x542fc1=>{const _0x982b39=_0x4b647c;return _0x542fc1=User['output'](_0x542fc1,_0x982b39(0x1eb)),_0x24f25b[_0x982b39(0x19c)]({'status':!![],'message':'success','data':_0x542fc1});})[_0x4b647c(0x18b)](_0x42e09c=>respondError(_0x24f25b,_0x42e09c));},exports[_0x5d33b3(0x1f5)]=(_0x4c7196,_0x38fbd4)=>{const _0x30046=_0x5d33b3,{uid:_0x241bf7}=getTokenInfo(_0x4c7196);return Promise['all']([User[_0x30046(0x1f5)]({'limit':_0x4c7196['query']['limit']||0xa,'page':_0x4c7196[_0x30046(0x188)]['page']||0x0}),User[_0x30046(0x1d0)]()])[_0x30046(0x1b9)](([_0x305fb2,_0x3f05cf])=>_0x38fbd4[_0x30046(0x19c)]({'status':!![],'message':_0x30046(0x1bd),'data':_0x305fb2[_0x30046(0x1ef)](_0x10ba7d=>User[_0x30046(0x160)](_0x10ba7d,_0x4c7196['query'][_0x30046(0x1b1)]||_0x30046(0x1eb))),'pager':{'limit':Number(_0x4c7196['query'][_0x30046(0x1b5)]||0xa),'page':Number(_0x4c7196[_0x30046(0x188)][_0x30046(0x1a5)]||0x0),'total':_0x3f05cf},'hasMore':(_0x4c7196[_0x30046(0x188)][_0x30046(0x1a5)]||0x0)*(_0x4c7196[_0x30046(0x188)][_0x30046(0x1b5)]||0xa)+_0x305fb2[_0x30046(0x1a6)]<_0x3f05cf}))[_0x30046(0x18b)](_0x46acde=>respondError(_0x38fbd4,_0x46acde));},exports[_0x5d33b3(0x185)]=(_0xa79b90,_0x16fd2a)=>{const _0x285152=_0x5d33b3,{uid:_0x38d98e,role:_0x173448}=getTokenInfo(_0xa79b90);let {limit:_0x585259,page:_0x518901}=_0xa79b90[_0x285152(0x188)];return _0x518901=Number(_0x518901),_0x585259=Number(_0x585259),Promise[_0x285152(0x19d)]([User[_0x285152(0x185)]({'limit':_0x585259,'page':_0x518901}),User[_0x285152(0x1bb)]()])['then'](([_0x179d5f,_0x25532a])=>{const _0x35affe=_0x285152,_0x4c889d=_0x518901*_0x585259+_0x179d5f[_0x35affe(0x1a6)]<_0x25532a;return _0x16fd2a[_0x35affe(0x19c)]({'status':!![],'message':_0x35affe(0x1bd),'data':_0x179d5f[_0x35affe(0x1ef)](_0x427bb9=>User['output'](_0x427bb9)),'pager':{'page':_0x518901,'limit':_0x585259,'total':_0x25532a},'hasMore':_0x4c889d});});},exports[_0x5d33b3(0x1e3)]=async(_0x5d13d1,_0x93ed0f)=>{const _0x18f2e7=_0x5d33b3,{uid:_0x306faa}=getTokenInfo(_0x5d13d1);let _0x6a9553=![],_0x31be48=0x0,_0x267873=_0x5d13d1[_0x18f2e7(0x1d5)]['card_number']||'',_0x2e3e6d,_0x17a30f=null,_0x54b0b4=[];return _0x267873&&([_0x17a30f]=await User[_0x18f2e7(0x17a)](_0x267873,0x1),_0x17a30f=_0x17a30f&&_0x17a30f['id']!==_0x306faa?_0x17a30f:null),User[_0x18f2e7(0x166)](_0x306faa)[_0x18f2e7(0x1b9)](async _0x35daac=>{const _0x539e9a=_0x18f2e7;_0x2e3e6d=_0x35daac[_0x539e9a(0x1b2)]||'';_0x5d13d1[_0x539e9a(0x1d5)][_0x539e9a(0x1b2)]===undefined&&(_0x267873=_0x2e3e6d);const _0x24c55b=Object[_0x539e9a(0x1a0)](_0x35daac);_0x24c55b[_0x539e9a(0x1c2)](_0x8e5648=>{const _0x105e1d=_0x539e9a;if(_0x5d13d1[_0x105e1d(0x1d5)][_0x8e5648]!==undefined&&['card_number','login_mode'][_0x105e1d(0x1ae)](_0x8e5648)){if([_0x105e1d(0x17b)]['includes'](_0x8e5648))_0x35daac[_0x8e5648]=JSON['stringify'](_0x5d13d1[_0x105e1d(0x1d5)][_0x8e5648]);else{if(_0x8e5648==='card_number'){}else _0x35daac[_0x8e5648]=_0x5d13d1[_0x105e1d(0x1d5)][_0x8e5648]!==undefined?_0x5d13d1[_0x105e1d(0x1d5)][_0x8e5648]:_0x35daac[_0x8e5648];}}});if(_0x267873!==_0x2e3e6d&&!_0x17a30f){_0x35daac[_0x539e9a(0x1b2)]=_0x267873;if(_0x35daac[_0x539e9a(0x1ad)]){const _0x58acca=_0x5d13d1[_0x539e9a(0x192)][_0x539e9a(0x157)][_0x539e9a(0x1bc)];await Promise['all']([models[_0x539e9a(0x16b)][_0x539e9a(0x159)]({'card_number':_0x2e3e6d}),models[_0x539e9a(0x16b)]['getChatToCard']({'card_number':_0x267873})])[_0x539e9a(0x1b9)](([_0x43865f,_0x3b302b])=>{const _0x43c9c8=_0x539e9a,_0x493818=[0x0];return _0x3b302b[_0x43c9c8(0x1c2)](_0x12ba95=>{const _0x242b90=_0x43c9c8,_0x43c5b0=JSON[_0x242b90(0x1c9)](_0x12ba95[_0x242b90(0x1ec)]);_0x493818[_0x242b90(0x1e9)](_0x43c5b0[0x0]);}),Promise[_0x43c9c8(0x19d)]([_0x43865f,_0x3b302b,models[_0x43c9c8(0x189)][_0x43c9c8(0x172)](_0x493818)]);})['then'](([_0x51e2c5,_0x1c9b1c,_0x152d09])=>{const _0x5003c4=_0x539e9a,_0x287647={};_0x152d09[_0x5003c4(0x1c2)](_0x4e32d8=>{_0x287647[_0x4e32d8['id']['toString']()]=_0x4e32d8;});const _0x2da3b7=_0x1c9b1c[_0x5003c4(0x1ef)](_0x28edc7=>{const _0x319e0c=_0x5003c4,_0x38dfb7=JSON[_0x319e0c(0x1c9)](_0x28edc7['user_ids'])[0x0];return{...models[_0x319e0c(0x16b)][_0x319e0c(0x160)](_0x28edc7),'user':models[_0x319e0c(0x189)][_0x319e0c(0x160)](_0x287647[_0x38dfb7[_0x319e0c(0x1c5)]()])};}),_0x20a43b=_0x51e2c5[_0x5003c4(0x1ef)](_0x149dc9=>_0x149dc9['id']);_0x58acca[_0x5003c4(0x1a2)](CONSTS['SKT_LTS_SINGLE'],{'to':_0x35daac[_0x5003c4(0x1ad)],'event':CONSTS[_0x5003c4(0x1aa)],'args':{'removed':_0x20a43b,'added':_0x2da3b7}});});}_0x35daac[_0x539e9a(0x1c3)]&&await models[_0x539e9a(0x16b)][_0x539e9a(0x1cf)]({'card_number':_0x2e3e6d}),_0x35daac[_0x539e9a(0x1c3)]=0x0;}return User['save'](_0x35daac);})[_0x18f2e7(0x1b9)](async _0x2c4886=>{const _0xf5685a=_0x18f2e7;return _0x267873&&_0x267873!==_0x2e3e6d&&_0x17a30f&&(_0x6a9553=!![],_0x31be48=_0x17a30f['id']),_0x93ed0f[_0xf5685a(0x19c)]({'status':!![],'message':'Profile\x20has\x20been\x20updated!','data':User['output'](_0x2c4886,_0xf5685a(0x1eb)),'cardVerified':{'exists':_0x6a9553,'user_id':_0x31be48}});})[_0x18f2e7(0x18b)](_0x312ad9=>respondError(_0x93ed0f,_0x312ad9));},exports[_0x5d33b3(0x187)]=(_0x15d79a,_0x201f51)=>{const _0x3986d9=_0x5d33b3,{id:_0x53f613}=_0x15d79a['params'],{uid:_0x35f122,role:_0x27b0ff}=getTokenInfo(_0x15d79a);return User[_0x3986d9(0x166)](_0x53f613)['then'](_0x18908e=>{const _0x337430=_0x3986d9,_0x20879c=Object[_0x337430(0x1a0)](_0x18908e);return _0x20879c[_0x337430(0x1c2)](_0x5e3527=>{const _0xc362d1=_0x337430;['location_array'][_0xc362d1(0x1ae)](_0x5e3527)?_0x18908e[_0x5e3527]=_0x15d79a[_0xc362d1(0x1d5)][_0x5e3527]?JSON['stringify'](_0x15d79a[_0xc362d1(0x1d5)][_0x5e3527]):_0x18908e[_0x5e3527]:_0x18908e[_0x5e3527]=_0x15d79a[_0xc362d1(0x1d5)][_0x5e3527]!==undefined?_0x15d79a[_0xc362d1(0x1d5)][_0x5e3527]:_0x18908e[_0x5e3527];}),User['save'](_0x18908e);})[_0x3986d9(0x1b9)](_0x403a45=>{const _0x13f6fd=_0x3986d9;return _0x201f51[_0x13f6fd(0x19c)]({'status':!![],'message':_0x13f6fd(0x165),'data':User[_0x13f6fd(0x160)](_0x403a45,'PROFILE')});});},exports[_0x5d33b3(0x1a1)]=(_0x586da0,_0x4a2b44)=>{const _0x414140=_0x5d33b3;let _0x35beeb=Number(_0x586da0['params']['id']);const {chat:_0x2514fb,comment:_0x54a8db,friend:_0x105040,post:_0x1d8fac,report:_0x3d0a9c}=_0x586da0[_0x414140(0x1d5)][_0x414140(0x16d)]||{};let _0x3370b3=![];return models[_0x414140(0x189)][_0x414140(0x182)](_0x35beeb)['then'](_0x2438e0=>{const _0x8f5364=_0x414140;_0x3370b3=_0x2438e0;if(!_0x2438e0)throw Object[_0x8f5364(0x1e8)](new Error(_0x8f5364(0x1e1)),{'code':0x190});return Promise['all']([_0x2514fb?models['chat'][_0x8f5364(0x1d4)](_0x35beeb):null,_0x54a8db?models[_0x8f5364(0x1c6)][_0x8f5364(0x1d4)](_0x35beeb):null,_0x1d8fac?models[_0x8f5364(0x194)][_0x8f5364(0x1d4)](_0x35beeb):null]);})[_0x414140(0x1b9)](([_0x524532,_0x2cf44f,_0x428382])=>{return{'status':!![],'message':'User\x20has\x20been\x20deleted!'};});},exports[_0x5d33b3(0x1e0)]=(_0xd9a745,_0x13820f)=>{const _0x4d42e3=_0x5d33b3,_0x3d0aad=Number(_0xd9a745[_0x4d42e3(0x1ee)]['id']);let _0x4f1d1a,_0x54d55a;return User[_0x4d42e3(0x166)](_0x3d0aad)[_0x4d42e3(0x1b9)](_0x6478a5=>{const _0x2a3085=_0x4d42e3;if(!_0x6478a5[_0x2a3085(0x1b2)]&&!_0x6478a5[_0x2a3085(0x1c0)])throw Object[_0x2a3085(0x1e8)](new Error(_0x2a3085(0x178)),{'code':0x190});return _0x4f1d1a=_0x6478a5,_0x54d55a=_0x6478a5[_0x2a3085(0x1b2)],Promise[_0x2a3085(0x19d)]([models[_0x2a3085(0x189)][_0x2a3085(0x17a)](_0x6478a5['card_number']),models['chat'][_0x2a3085(0x159)]({'card_number':_0x6478a5[_0x2a3085(0x1b2)]})]);})['then'](([_0x1cefe3,_0xb96f45])=>{return Promise['all']([manageVerificationStatusOfUsers(_0x1cefe3,_0x3d0aad),processChatroomToCard(_0xb96f45,_0x3d0aad)]);})[_0x4d42e3(0x1b9)](async([_0x4b4759,_0x2c9318])=>{const _0x597a1b=_0x4d42e3,_0x4a04b2=_0x2c9318[_0x597a1b(0x1ef)](_0x13bfd6=>{const _0x167f79=_0x597a1b,_0x450ac5=JSON[_0x167f79(0x1c9)](_0x13bfd6['user_ids']);return _0x450ac5[0x0];})['filter']((_0xe6a3f1,_0x56b9b7,_0x1fbccd)=>_0x1fbccd[_0x597a1b(0x1b7)](_0xe6a3f1)===_0x56b9b7);return await models['user'][_0x597a1b(0x172)](_0x4a04b2)[_0x597a1b(0x1b9)](_0x4dfef4=>{const _0x44ebfa=_0x597a1b,_0x422a6f=_0xd9a745['app']['locals'][_0x44ebfa(0x1bc)];_0x4dfef4[_0x44ebfa(0x1c2)]((_0x5c8afc,_0x2fb711)=>{const _0x207890=_0x44ebfa;if(_0x5c8afc[_0x207890(0x1ad)]){const [_0x7f2e6f]=_0x2c9318['filter'](_0x586b69=>{const _0x4cca8b=_0x207890,_0x10de0f=typeof _0x586b69[_0x4cca8b(0x1ec)]===_0x4cca8b(0x173)?JSON[_0x4cca8b(0x1c9)](_0x586b69[_0x4cca8b(0x1ec)]):_0x586b69[_0x4cca8b(0x1ec)];return _0x10de0f[0x0]===_0x5c8afc['id'];});_0x422a6f[_0x207890(0x1a2)](CONSTS[_0x207890(0x193)],{'to':_0x5c8afc[_0x207890(0x1ad)],'event':CONSTS[_0x207890(0x1db)],'args':{'chat':{...models[_0x207890(0x16b)][_0x207890(0x160)](_0x7f2e6f),'user':models[_0x207890(0x189)][_0x207890(0x160)](_0x4f1d1a)}}});}});}),{'status':!![],'message':'success','verified':_0x4b4759,'chatrooms':_0x2c9318};});},exports['verifyUser']=({user_id:_0x4d827a,socketClient:_0x4cde57})=>{const _0x311594=_0x5d33b3;let _0x44dbf2,_0x3323bc;return User['getById'](_0x4d827a)[_0x311594(0x1b9)](_0x4723a1=>{const _0x2278e6=_0x311594;console[_0x2278e6(0x1c7)](_0x2278e6(0x16c),_0x4d827a);if(!_0x4723a1[_0x2278e6(0x1b2)]&&!_0x4723a1['card_img_url'])throw Object[_0x2278e6(0x1e8)](new Error(_0x2278e6(0x178)),{'code':0x190});return _0x44dbf2=_0x4723a1,_0x3323bc=_0x4723a1[_0x2278e6(0x1b2)],Promise['all']([models['user']['getByCard'](_0x4723a1['card_number']),models[_0x2278e6(0x16b)][_0x2278e6(0x159)]({'card_number':_0x4723a1[_0x2278e6(0x1b2)]})]);})[_0x311594(0x1b9)](([_0x3ff2c6,_0x289a56])=>{const _0x2e10e1=_0x311594;return Promise[_0x2e10e1(0x19d)]([manageVerificationStatusOfUsers(_0x3ff2c6,_0x4d827a),processChatroomToCard(_0x289a56,_0x4d827a)]);})[_0x311594(0x1b9)](async([_0x11b27c,_0x1af845])=>{const _0x256a1a=_0x311594;[_0x44dbf2]=_0x11b27c[_0x256a1a(0x174)](_0x182767=>_0x182767['id']===_0x4d827a);const _0x4e5291=_0x1af845['map'](_0x3c30a6=>{const _0x29a6ba=_0x256a1a,_0x14889d=JSON[_0x29a6ba(0x1c9)](_0x3c30a6[_0x29a6ba(0x1ec)]);return _0x14889d[0x0];})['filter']((_0x100c67,_0x1a3fba,_0x3504c4)=>_0x3504c4[_0x256a1a(0x1b7)](_0x100c67)===_0x1a3fba),_0x5abd02=helpers[_0x256a1a(0x1c4)][_0x256a1a(0x1a4)]({'isFromAdmin':0x1,'sender_id':0x0,'receiver_id':_0x4d827a,'type':NOTI_TYPES[_0x256a1a(0x1b0)],'optional_val':_0x3323bc,'time':generateTZTimeString()}),_0x43d8e3=await models[_0x256a1a(0x1dd)][_0x256a1a(0x169)](_0x5abd02);_0x44dbf2[_0x256a1a(0x15c)]++,await models[_0x256a1a(0x189)][_0x256a1a(0x155)](_0x44dbf2);_0x44dbf2[_0x256a1a(0x1ad)]&&_0x4cde57[_0x256a1a(0x1a2)](CONSTS[_0x256a1a(0x193)],{'to':_0x44dbf2[_0x256a1a(0x1ad)],'event':CONSTS[_0x256a1a(0x1e7)],'args':{'num':_0x44dbf2[_0x256a1a(0x15c)],'notification':_0x43d8e3}});_0x11b27c[_0x256a1a(0x174)](_0x288d7b=>_0x288d7b['id']!==_0x4d827a)['forEach'](async _0x2b0b3d=>{const _0x4c4d32=_0x256a1a,_0xe44358=helpers[_0x4c4d32(0x1c4)]['generateNotificationData']({'isFromAdmin':0x1,'sender_id':0x0,'receiver_id':_0x2b0b3d['id'],'type':NOTI_TYPES[_0x4c4d32(0x15a)],'optional_val':_0x3323bc,'time':generateTZTimeString()}),_0x148fca=await models['notification'][_0x4c4d32(0x169)](_0xe44358);_0x2b0b3d[_0x4c4d32(0x15c)]++,await models[_0x4c4d32(0x189)]['save'](_0x2b0b3d),_0x2b0b3d[_0x4c4d32(0x1ad)]&&_0x4cde57['emit'](CONSTS[_0x4c4d32(0x193)],{'to':_0x2b0b3d[_0x4c4d32(0x1ad)],'event':CONSTS[_0x4c4d32(0x1e7)],'args':{'num':_0x2b0b3d[_0x4c4d32(0x15c)],'notification':_0x148fca}});});const _0xc0a27b=await models[_0x256a1a(0x189)][_0x256a1a(0x172)](_0x4e5291['length']?_0x4e5291:[0x0]);return console[_0x256a1a(0x1c7)](_0x256a1a(0x1ca)),_0x11b27c[_0x256a1a(0x174)](_0x1575d5=>_0x1575d5[_0x256a1a(0x1ad)])['forEach'](_0xff97ed=>{const _0x657d94=_0x256a1a;console['log'](_0x657d94(0x1b4),_0xff97ed['id'],_0xff97ed['user_name'],_0xff97ed[_0x657d94(0x1c3)]);const _0x1e6e1e=[],_0x4ec7af=[];_0xff97ed['id']===_0x4d827a?(console[_0x657d94(0x1c7)](_0x657d94(0x164)),_0x4cde57[_0x657d94(0x1a2)](CONSTS[_0x657d94(0x193)],{'to':_0xff97ed[_0x657d94(0x1ad)],'event':CONSTS[_0x657d94(0x1aa)],'args':{'added':_0x1af845[_0x657d94(0x1ef)](_0x1986f0=>({...models[_0x657d94(0x16b)]['output'](_0x1986f0),'user':models[_0x657d94(0x189)][_0x657d94(0x160)](_0xc0a27b[JSONParser(_0x1986f0['user_ids'])[0x0][_0x657d94(0x1c5)]()])})),'removed':[],'your_name':_0xff97ed[_0x657d94(0x17d)]}})):(console['log'](_0x657d94(0x1da)),_0x4cde57[_0x657d94(0x1a2)](CONSTS[_0x657d94(0x193)],{'to':_0xff97ed[_0x657d94(0x1ad)],'event':CONSTS['SKT_CHATLIST_UPDATED'],'args':{'removed':_0x1af845[_0x657d94(0x1ef)](_0x427a6e=>_0x427a6e['id']),'added':[],'your_name':_0xff97ed[_0x657d94(0x17d)]}}));}),_0xc0a27b[_0x256a1a(0x1c2)]((_0x4db022,_0x4a3ab1)=>{const _0x4090a2=_0x256a1a;if(_0x4db022[_0x4090a2(0x1ad)]){const [_0x5c7f0f]=_0x1af845[_0x4090a2(0x174)](_0x222a4a=>{const _0x12aee9=_0x4090a2,_0x1ae2cb=typeof _0x222a4a[_0x12aee9(0x1ec)]==='string'?JSON[_0x12aee9(0x1c9)](_0x222a4a[_0x12aee9(0x1ec)]):_0x222a4a[_0x12aee9(0x1ec)];return _0x1ae2cb[0x0]===_0x4db022['id'];});_0x4cde57[_0x4090a2(0x1a2)](CONSTS[_0x4090a2(0x193)],{'to':_0x4db022[_0x4090a2(0x1ad)],'event':CONSTS[_0x4090a2(0x1db)],'args':{'chat':{...models['chat'][_0x4090a2(0x160)](_0x5c7f0f),'user':models[_0x4090a2(0x189)][_0x4090a2(0x160)](_0x44dbf2)}}});}}),{'status':!![],'message':_0x256a1a(0x1bd),'verified':_0x11b27c,'chatrooms':_0x1af845};});},exports[_0x5d33b3(0x1d3)]=(_0x50aaec,_0x2490c1)=>{const _0x1eef8=_0x5d33b3,{id:_0x2067b0}=_0x50aaec['params'];let _0x2a4911;return User['getById'](_0x2067b0)['then'](_0x2dbdff=>{const _0xf02b6e=_0x3ff3,{card_number:_0x575ff8,card_verified:_0x4c3521}=_0x2dbdff;return _0x2dbdff['card_verified']=0x0,Promise[_0xf02b6e(0x19d)]([User['save'](_0x2dbdff),models['chat'][_0xf02b6e(0x159)](_0x575ff8)]);})[_0x1eef8(0x1b9)](([_0x2616fc,_0x13fd73])=>{const _0x836520=_0x1eef8;if(_0x13fd73[_0x836520(0x1a6)])return unverifyCardChats(_0x13fd73);})[_0x1eef8(0x1b9)](()=>({'status':!![],'message':_0x1eef8(0x196)}));},exports[_0x5d33b3(0x15f)]=(_0x53ad37,_0x18a00f)=>{const _0xcf9f10=_0x5d33b3,{uid:_0x371438}=getTokenInfo(_0x53ad37);return User[_0xcf9f10(0x166)](_0x371438)[_0xcf9f10(0x1b9)](_0x41569b=>{const _0x3941e9=_0xcf9f10;return _0x41569b['ban_reply']=_0x53ad37[_0x3941e9(0x1d5)][_0x3941e9(0x191)],User[_0x3941e9(0x155)](_0x41569b);})[_0xcf9f10(0x1b9)](_0xd27f4d=>({'status':!![],'message':_0xcf9f10(0x1f0)}));},exports[_0x5d33b3(0x1df)]=({fromId:_0x41aaa1,toId:_0x4da6ab,socketClient:_0x4be4a0})=>{const _0x5d26a7=_0x5d33b3;let _0x2b3674;return models[_0x5d26a7(0x189)][_0x5d26a7(0x166)](_0x41aaa1)['then'](_0x30e9af=>{const _0x22e286=_0x5d26a7;let _0x564720=helpers[_0x22e286(0x161)][_0x22e286(0x163)](_0x30e9af[_0x22e286(0x1f2)]);if(typeof _0x564720!==_0x22e286(0x184))_0x564720=[];if(!_0x564720[_0x22e286(0x1ae)](_0x4da6ab))_0x564720[_0x22e286(0x1e9)](_0x4da6ab);return _0x30e9af['black_list']=_0x564720,models[_0x22e286(0x189)][_0x22e286(0x155)](_0x30e9af);})[_0x5d26a7(0x1b9)](_0x593c65=>{const _0x187861=_0x5d26a7;_0x2b3674=_0x593c65;let _0x18a0ea=helpers['common'][_0x187861(0x163)](_0x593c65[_0x187861(0x1f2)]);if(typeof _0x18a0ea!==_0x187861(0x184))_0x18a0ea=[];return models[_0x187861(0x189)][_0x187861(0x172)](_0x18a0ea);})[_0x5d26a7(0x1b9)](_0x39d6ed=>{const _0x200608=_0x5d26a7,[_0x155cfb]=_0x39d6ed[_0x200608(0x174)](_0x25ab49=>_0x25ab49['id']===_0x4da6ab);return _0x155cfb&&_0x155cfb[_0x200608(0x1ad)]&&_0x4be4a0[_0x200608(0x1a2)](CONSTS[_0x200608(0x193)],{'users':_0x155cfb['socket_id'],'event':CONSTS[_0x200608(0x195)],'args':{'message':_0x200608(0x1f3),'user':User['output'](_0x2b3674)}}),{'status':!![],'message':_0x200608(0x162)+_0x155cfb[_0x200608(0x17d)]+'\x27','black_list':_0x39d6ed[_0x200608(0x1ef)](_0x219295=>models[_0x200608(0x189)][_0x200608(0x160)](_0x219295))};});},exports[_0x5d33b3(0x171)]=({fromId:_0x557188,toId:_0x200b28,socketClient:_0x5f4f37})=>{const _0x215f31=_0x5d33b3;let _0x30d036;return models[_0x215f31(0x189)][_0x215f31(0x166)](_0x557188)['then'](_0x18b632=>{const _0x4a1367=_0x215f31;let _0x6be1fd=helpers[_0x4a1367(0x161)][_0x4a1367(0x163)](_0x18b632['black_list']||'[]');if(_0x6be1fd['includes'](_0x200b28))_0x6be1fd[_0x4a1367(0x1ce)](_0x6be1fd['indexOf'](_0x200b28),0x1);return _0x18b632[_0x4a1367(0x1f2)]=_0x6be1fd,models[_0x4a1367(0x189)]['save'](_0x18b632);})[_0x215f31(0x1b9)](_0x2e4905=>{const _0x15431d=_0x215f31;_0x30d036=_0x2e4905;let _0x3f6fa7=helpers[_0x15431d(0x161)][_0x15431d(0x163)](_0x2e4905[_0x15431d(0x1f2)]);if(typeof _0x3f6fa7!=='object')_0x3f6fa7=[];return Promise['all']([models[_0x15431d(0x189)][_0x15431d(0x172)](_0x3f6fa7),models['user'][_0x15431d(0x166)](_0x200b28)]);})[_0x215f31(0x1b9)](([_0x593c23,_0x306fbd])=>{const _0x3909e9=_0x215f31;return _0x306fbd&&_0x306fbd[_0x3909e9(0x1ad)]&&_0x5f4f37[_0x3909e9(0x1a2)](CONSTS[_0x3909e9(0x193)],{'users':_0x306fbd['socket_id'],'event':CONSTS['SKT_BLOCK_BLOCKED'],'args':{'message':_0x3909e9(0x1c1),'user':User['output'](_0x30d036)}}),{'status':!![],'message':_0x3909e9(0x18d)+_0x306fbd[_0x3909e9(0x17d)]+'\x27','black_list':_0x593c23['map'](_0x5dc56c=>models[_0x3909e9(0x189)]['output'](_0x5dc56c))};});},exports['createIDTransferReq']=async({user_id:_0x79e93d,card_number:_0x57ee3a,socketClient:_0x14ca5a})=>{const _0x4e416b=_0x5d33b3;let _0x6a35b6,_0x2007f9;return[_0x2007f9]=await models['user'][_0x4e416b(0x17a)](_0x57ee3a,0x1),User[_0x4e416b(0x166)](_0x79e93d)[_0x4e416b(0x1b9)](_0x499682=>{const _0x37a576=_0x4e416b;_0x6a35b6=_0x499682;const _0x4bc804=helpers[_0x37a576(0x1c4)]['generateAdminNotiData']({'type':ADMIN_NOTI_TYPES['ID_TRANSFER'],'payload':{'from':_0x2007f9['id'],'to':_0x499682['id'],'card_number':_0x57ee3a}}),_0x4513d9=helpers[_0x37a576(0x1c4)][_0x37a576(0x1a4)]({'sender_id':_0x79e93d,'receiver_id':_0x2007f9['id'],'type':NOTI_TYPES[_0x37a576(0x1f6)],'optional_val':_0x57ee3a});return _0x2007f9[_0x37a576(0x15c)]++,Promise[_0x37a576(0x19d)]([models[_0x37a576(0x189)][_0x37a576(0x155)](_0x2007f9),models[_0x37a576(0x1dd)][_0x37a576(0x169)](_0x4513d9),models[_0x37a576(0x1a8)][_0x37a576(0x169)](_0x4bc804)]);})[_0x4e416b(0x1b9)](([_0x509ed6,_0x393708,_0x3391d6])=>{const _0x3c2c32=_0x4e416b;return _0x2007f9['socket_id']&&_0x14ca5a[_0x3c2c32(0x1a2)](CONSTS[_0x3c2c32(0x193)],{'to':_0x2007f9[_0x3c2c32(0x1ad)],'event':CONSTS[_0x3c2c32(0x1e7)],'args':{'num':_0x2007f9[_0x3c2c32(0x15c)],'notification':{...models[_0x3c2c32(0x1dd)]['output'](_0x393708),'sender':models[_0x3c2c32(0x189)]['output'](_0x6a35b6)}}}),{'status':!![],'message':_0x3c2c32(0x168)};});},exports[_0x5d33b3(0x1de)]=async({user_id:_0x2701d6,noti_id:_0x507d41,accept:_0x5b88ea,socketClient:_0x23a86f,..._0x495b95})=>{const _0x23aa75=_0x5d33b3;let _0x4c5cde,_0x5151c8;return Promise['all']([models[_0x23aa75(0x189)]['getById'](_0x2701d6),models['notification'][_0x23aa75(0x166)](_0x507d41)])[_0x23aa75(0x1b9)](([_0x5d8dca,_0x4e870d])=>{const _0x36a232=_0x23aa75;_0x4c5cde=_0x5d8dca,_0x5151c8=_0x4e870d;if(_0x5d8dca[_0x36a232(0x1b2)]!==_0x4e870d[_0x36a232(0x1f7)]||_0x4e870d[_0x36a232(0x19e)]!==_0x2701d6)throw Object[_0x36a232(0x1e8)](new Error('You\x20have\x20no\x20permission\x20to\x20reply\x20this\x20request!'));return models['user']['getById'](_0x4e870d[_0x36a232(0x1d8)]);})[_0x23aa75(0x1b9)](_0x4751c6=>{const _0x10d644=_0x23aa75;if(!_0x4751c6)throw Object[_0x10d644(0x1e8)](new Error(_0x10d644(0x16f)));const _0xf486d0=helpers['model']['generateNotificationData']({'sender_id':_0x2701d6,'receiver_id':_0x4751c6['id'],'type':_0x5b88ea?NOTI_TYPES[_0x10d644(0x180)]:NOTI_TYPES[_0x10d644(0x1e4)],'optional_val':_0x5151c8[_0x10d644(0x1f7)]});return _0x4c5cde[_0x10d644(0x15c)]++,Promise[_0x10d644(0x19d)]([_0x4751c6,models[_0x10d644(0x1dd)][_0x10d644(0x169)](_0xf486d0),models['adminNotification'][_0x10d644(0x1b6)]({'from':_0x4751c6['id'],'to':_0x2701d6}),models[_0x10d644(0x189)][_0x10d644(0x155)](_0x4c5cde)]);})[_0x23aa75(0x1b9)](async([_0xfd926a,_0x2971f0,_0x2dcd86,_0x4a7d7f])=>{const _0x44432=_0x23aa75;return _0xfd926a[_0x44432(0x1ad)]&&_0x23a86f['emit'](CONSTS[_0x44432(0x193)],{'to':_0xfd926a[_0x44432(0x1ad)],'event':CONSTS[_0x44432(0x1e7)],'args':{'num':_0x4c5cde[_0x44432(0x15c)],'notification':{...models[_0x44432(0x1dd)]['output'](_0x2971f0),'sender':models['user']['output'](_0x4c5cde)}}}),_0x5b88ea&&(_0xfd926a['card_number']=_0x2971f0[_0x44432(0x1d9)][_0x44432(0x18a)],await models[_0x44432(0x189)][_0x44432(0x155)](_0xfd926a),await this['verifyUser']({'user_id':_0x2701d6,'socketClient':_0x23a86f}),(_0x4c5cde[_0x44432(0x1ad)]||_0xfd926a['socket_id'])&&await Promise[_0x44432(0x19d)]([_0x4c5cde['card_number']?models[_0x44432(0x16b)][_0x44432(0x159)]({'card_number':_0x4c5cde[_0x44432(0x1b2)]}):[],models[_0x44432(0x16b)][_0x44432(0x159)]({'card_number':_0x2971f0[_0x44432(0x1f7)]})])[_0x44432(0x1b9)](([_0x4ece4b,_0x48600d])=>{const _0x82e0bd=_0x44432,_0x54a6fb=[0x0];return _0x48600d['forEach'](_0x4d0fd2=>{const _0x4259f3=_0x3ff3,_0x2ecbec=JSON[_0x4259f3(0x1c9)](_0x4d0fd2[_0x4259f3(0x1ec)]);_0x54a6fb[_0x4259f3(0x1e9)](_0x2ecbec[0x0]);}),Promise[_0x82e0bd(0x19d)]([_0x4ece4b,_0x48600d,models[_0x82e0bd(0x189)][_0x82e0bd(0x172)](_0x54a6fb)]);})[_0x44432(0x1b9)](([_0x3c7418,_0xb01ff6,_0x307472])=>{const _0x59c573=_0x44432,_0x6f118b={};_0x307472[_0x59c573(0x1c2)](_0x46d0cb=>{const _0xea432c=_0x59c573;_0x6f118b[_0x46d0cb['id'][_0xea432c(0x1c5)]()]=_0x46d0cb;}),_0xfd926a['socket_id']&&_0x23a86f[_0x59c573(0x1a2)](CONSTS[_0x59c573(0x193)],{'to':_0xfd926a['socket_id'],'event':CONSTS[_0x59c573(0x1aa)],'args':{'added':_0xb01ff6[_0x59c573(0x1ef)](_0x5ce5b8=>{const _0x5e3e0e=_0x59c573,_0x21a197=JSON[_0x5e3e0e(0x1c9)](_0x5ce5b8[_0x5e3e0e(0x1ec)])[0x0];return{...models[_0x5e3e0e(0x16b)][_0x5e3e0e(0x160)](_0x5ce5b8),'user':models[_0x5e3e0e(0x189)][_0x5e3e0e(0x160)](_0x6f118b[_0x21a197[_0x5e3e0e(0x1c5)]()])};}),'removed':_0x3c7418[_0x59c573(0x1ef)](_0x51eaa0=>_0x51eaa0['id'])}}),_0xfd926a[_0x59c573(0x1ad)]&&_0x23a86f['emit'](CONSTS['SKT_LTS_SINGLE'],{'to':_0xfd926a['socket_id'],'event':CONSTS[_0x59c573(0x1aa)],'args':{'added':[],'removed':_0xb01ff6[_0x59c573(0x1ef)](_0x2a9711=>_0x2a9711['id'])}});})),{'status':!![],'message':'You\x20replied\x20to\x20the\x20card\x20transfer\x20request!'};});},exports[_0x5d33b3(0x183)]=async(_0x467b5f,_0x100043)=>{const _0x483a20=_0x5d33b3,{uid:_0x14c325}=getTokenInfo(_0x467b5f);let _0x48e40d;return models[_0x483a20(0x189)][_0x483a20(0x166)](_0x14c325)[_0x483a20(0x1b9)](_0x5d80b7=>{const _0x2a5a04=_0x483a20;if(!_0x5d80b7)throw Object[_0x2a5a04(0x1e8)](new Error(_0x2a5a04(0x19f)),{'code':0x190});if(!_0x5d80b7[_0x2a5a04(0x1b2)])throw Object['assign'](new Error(_0x2a5a04(0x1f1)),{'code':0x190});if(_0x5d80b7[_0x2a5a04(0x1c3)])throw Object['assign'](new Error('You\x27re\x20already\x20verified!'),{'code':0x190});_0x48e40d=_0x5d80b7;const _0x56b891=helpers[_0x2a5a04(0x1c4)][_0x2a5a04(0x1ed)]({'type':ADMIN_NOTI_TYPES[_0x2a5a04(0x1a9)],'payload':{'user_id':_0x14c325,'card_number':_0x5d80b7[_0x2a5a04(0x1b2)]},'emails':[]});return models[_0x2a5a04(0x1a8)][_0x2a5a04(0x169)](_0x56b891);})[_0x483a20(0x1b9)](_0x137a9a=>{const _0x33266d=_0x483a20;return{'status':!![],'message':_0x33266d(0x1cd)};});};const manageVerificationStatusOfUsers=(_0x16b89c,_0x511f62)=>{const _0x4a5878=_0x5d33b3,_0x2e96ab=_0x16b89c[0x0]['card_number'];return Promise[_0x4a5878(0x19d)](_0x16b89c['map'](_0x4738d9=>User['save']({..._0x4738d9,'card_verified':_0x4738d9['id']===_0x511f62?0x1:0x0,'card_number':_0x4738d9['id']===_0x511f62?_0x2e96ab:'','card_img_url':_0x4738d9['id']===_0x511f62?_0x4738d9['card_img_url']:''})))[_0x4a5878(0x1b9)](_0x2a1bf4=>_0x2a1bf4)[_0x4a5878(0x18b)](_0x19342d=>{const _0x49fba4=_0x4a5878;return console[_0x49fba4(0x1c7)]('[Users\x20verify\x20status]\x20error',_0x19342d),![];});},processChatroomToCard=async(_0x5e51e5,_0x30e18c)=>{const _0x2123f9=_0x5d33b3,_0x11955d=await User[_0x2123f9(0x166)](_0x30e18c);return Promise[_0x2123f9(0x19d)](_0x5e51e5[_0x2123f9(0x1ef)](async _0x449e70=>{const _0x18723b=_0x2123f9,_0x41b891=JSON['parse'](_0x449e70[_0x18723b(0x1ec)]),_0x3574d2=![];let _0x23a029={};if(!_0x3574d2)_0x23a029={'user_ids':JSON[_0x18723b(0x17e)]([_0x41b891[0x0],_0x30e18c])};else{if(_0x41b891[_0x41b891[_0x18723b(0x1a6)]-0x1]!==_0x30e18c){console['log']('[ID\x20Transfer]\x20acceptable');const _0x296486=await models[_0x18723b(0x175)][_0x18723b(0x18f)](_0x449e70['id']),_0x4a13dd=JSON['parse'](_0x449e70[_0x18723b(0x176)]||'[]'),_0x39340b=JSON['parse'](_0x449e70[_0x18723b(0x1bf)]||'[]');_0x23a029=checkDuplicatedOwner({'user_ids':[..._0x41b891,_0x30e18c],'isTransfered':!![],'lastMsgIdOnTransfer':[..._0x4a13dd,_0x296486?_0x296486['id']:0x0],'last_messages':[..._0x39340b,{'msg':_0x296486['message'],'time':_0x296486['time']}]});}else console[_0x18723b(0x1c7)](_0x18723b(0x17f)),_0x23a029={'card_number':_0x449e70[_0x18723b(0x1b2)]};}return _0x23a029['id']=_0x449e70['id'],_0x23a029[_0x18723b(0x1c3)]=0x1,Promise[_0x18723b(0x19d)]([models['chat'][_0x18723b(0x155)](_0x23a029),models[_0x18723b(0x175)]['updateReceiverInCardChat'](_0x449e70['id'],_0x30e18c)]);}))[_0x2123f9(0x1b9)](([[_0x55309b]])=>[_0x55309b])[_0x2123f9(0x18b)](_0x37c620=>{const _0x153b78=_0x2123f9;return console[_0x153b78(0x1c7)](_0x153b78(0x1e5),_0x37c620),![];});},checkDuplicatedOwner=_0x20cac5=>{const _0x30ec6b=_0x5d33b3;let {user_ids:_0x20275c,isTransfered:_0x16ec50,lastMsgIdOnTransfer:_0x58120d,last_messages:_0x3e5bb8}=_0x20cac5;const _0x77ade9=_0x20275c[_0x20275c[_0x30ec6b(0x1a6)]-0x1];if(_0x20275c[_0x30ec6b(0x1a6)]>0x3){let _0x552a05=_0x20275c[_0x30ec6b(0x1b7)](_0x77ade9);_0x552a05>0x0&&_0x552a05<_0x20275c['length']-0x1&&(user['ids'][_0x30ec6b(0x1ce)](_0x552a05,0x1),_0x58120d[_0x30ec6b(0x1ce)](_0x552a05-0x2,0x1),_0x3e5bb8[_0x30ec6b(0x1ce)](_0x552a05-0x1,0x1));}return{'user_ids':JSON['stringify'](_0x20275c),'isTransfered':_0x16ec50,'lastMsgIdOnTransfer':JSON[_0x30ec6b(0x17e)](_0x58120d),'last_messages':JSON[_0x30ec6b(0x17e)](_0x3e5bb8)};},unverifyCardChats=_0x5b0886=>{const _0x5cdb43=_0x5d33b3;return Promise[_0x5cdb43(0x19d)](_0x5b0886[_0x5cdb43(0x1ef)](_0x454e9d=>{const _0x5b9b10=_0x5cdb43;_0x454e9d['card_verified']=0x0;const _0x10c5e8=JSONParser(_0x454e9d[_0x5b9b10(0x1ec)]);return _0x454e9d[_0x5b9b10(0x1ec)]=JSONStringify([_0x10c5e8[0x0]]),Promise[_0x5b9b10(0x19d)]([models[_0x5b9b10(0x16b)][_0x5b9b10(0x155)](_0x454e9d),models['message'][_0x5b9b10(0x1b8)](_0x454e9d['id'],0x0)]);}))['then'](([[_0x2c32a1,_0x5bd924]])=>[_0x2c32a1]);},generateUsername=async _0x2abe15=>{const _0x2dcd05=_0x5d33b3;if(_0x2abe15[_0x2dcd05(0x1ae)]('@'))_0x2abe15=_0x2abe15[_0x2dcd05(0x186)]('@')[0x0];return User[_0x2dcd05(0x1e6)](_0x2abe15)[_0x2dcd05(0x1b9)](_0x43e899=>{const _0xb66357=_0x2dcd05;if(!_0x43e899)return _0x2abe15;else return generateUsername(_0x2abe15+helpers[_0xb66357(0x161)][_0xb66357(0x177)](0x3));});};exports[_0x5d33b3(0x156)]=generateUsername;