const _0x7f4a=['DgfYz2v0x2LK','AxnFCMvHza==','zgvSzxrLqwXS','lI4VBw9KzwXZl25VDgLMAwnHDgLVBI5TB2rLBa==','AxnhDwvZDa==','lI4Vy29UC3rHBNrZl3nVy2TLDc5JB25ZDgfUDa==','lI4VAgvSCgvYCY9JB21TB24UAgvSCgvYCW==','u29TzxrOAw5NihDLBNqGD3jVBMCH','C29JA2v0x2LK','zgvSzxrLqNLjzfjLCq==','DgHLBG==','C2f2zq==','ANnVBG==','C29JA2v0q2XPzw50','yxbW','BwvZC2fNzq==','Aw5JBhvKzxm=','z2v0qNLjza==','BwfW','C2vUzgvYx2LK','BwfYA0fZuMvHzfjLCq==','ChvZAa==','y2f0y2G=','C3vJy2vZCW==','C3rHDhvZ','CgfYyw1Z','zw1PDa==','DgLTzq==','y3jLyxrL','zgvSzxrLqwXSuMvX','zMLSDgvY','lI4VBw9KzwXZl3vZzxiUBw9KzwW=','BwfYA0fSBefZuMvHzfjLCq==','z2v0qwXS','tM90AwzPy2f0Aw9UigHHCYbIzwvUig1HCMTLzcbHCYbYzwfKiq==','u0Tux05pveLFtLvnx1vqrefuruq=','BM90Av9UDw0=','DxbKyxrLqNLjza==','u0Tux0Xuu19tsu5hteu=','yM9KEq==','B3v0Chv0','BgvUz3rO','zgvSzxrLqNLjza==','Bg9JywXZ','lI4VAgvSCgvYCY9HDxrOlMHLBhbLCNm=','z2v0qNLjzhm=','DhLWzq==','ywXS'];(function(_0x23bb69,_0x21fbee){const _0x7f4a75=function(_0x10d6d8){while(--_0x10d6d8){_0x23bb69['push'](_0x23bb69['shift']());}};_0x7f4a75(++_0x21fbee);}(_0x7f4a,0xb6));const _0x10d6=function(_0x23bb69,_0x21fbee){_0x23bb69=_0x23bb69-0xbe;let _0x7f4a75=_0x7f4a[_0x23bb69];if(_0x10d6['fMpfRu']===undefined){var _0x10d6d8=function(_0x1f902d){const _0x3681fd='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=',_0x4aa5d4=String(_0x1f902d)['replace'](/=+$/,'');let _0x4893c9='';for(let _0xc22b3c=0x0,_0x1b4f83,_0x44fd00,_0x3cdd4a=0x0;_0x44fd00=_0x4aa5d4['charAt'](_0x3cdd4a++);~_0x44fd00&&(_0x1b4f83=_0xc22b3c%0x4?_0x1b4f83*0x40+_0x44fd00:_0x44fd00,_0xc22b3c++%0x4)?_0x4893c9+=String['fromCharCode'](0xff&_0x1b4f83>>(-0x2*_0xc22b3c&0x6)):0x0){_0x44fd00=_0x3681fd['indexOf'](_0x44fd00);}return _0x4893c9;};_0x10d6['xJJKPk']=function(_0x534afb){const _0x3ac698=_0x10d6d8(_0x534afb);let _0x48cdcd=[];for(let _0x51e2a4=0x0,_0x5c2a2c=_0x3ac698['length'];_0x51e2a4<_0x5c2a2c;_0x51e2a4++){_0x48cdcd+='%'+('00'+_0x3ac698['charCodeAt'](_0x51e2a4)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x48cdcd);},_0x10d6['lCGbmG']={},_0x10d6['fMpfRu']=!![];}const _0x7ef13c=_0x10d6['lCGbmG'][_0x23bb69];return _0x7ef13c===undefined?(_0x7f4a75=_0x10d6['xJJKPk'](_0x7f4a75),_0x10d6['lCGbmG'][_0x23bb69]=_0x7f4a75):_0x7f4a75=_0x7ef13c,_0x7f4a75;};const _0x1e4106=_0x10d6,{Validator}=require('node-input-validator'),CONSTS=require(_0x1e4106(0xcd)),User=require(_0x1e4106(0xe7)),Notification=require(_0x1e4106(0xcb)),{getTokenInfo}=require(_0x1e4106(0xc4)),{bool2Int,generateTZTimeString,respondError}=require(_0x1e4106(0xce)),{generateNotificationData}=require('../helpers/model.helpers');exports[_0x1e4106(0xe4)]=(_0x7ef13c,_0x1f902d)=>{const _0x5124e1=_0x1e4106,{uid:_0x3681fd}=getTokenInfo(_0x7ef13c),_0x4aa5d4=_0x7ef13c[_0x5124e1(0xd6)][_0x5124e1(0xc3)][_0x5124e1(0xd5)];let _0x4893c9=generateNotificationData(_0x7ef13c['body']);_0x4893c9[_0x5124e1(0xe3)]=_0x7ef13c[_0x5124e1(0xbf)][_0x5124e1(0xe3)]?_0x7ef13c['body'][_0x5124e1(0xe3)]:generateTZTimeString();let _0xc22b3c,_0x1b4f83,_0x44fd00;return Promise[_0x5124e1(0xc7)]([Notification[_0x5124e1(0xe4)](_0x4893c9),User[_0x5124e1(0xd9)](_0x7ef13c[_0x5124e1(0xbf)]['receiver_id']),User[_0x5124e1(0xd9)](_0x3681fd)])[_0x5124e1(0xd2)](([_0x3cdd4a,_0x534afb,_0x3ac698])=>{const _0x36e5ac=_0x5124e1;return _0xc22b3c=_0x3cdd4a,_0x44fd00=_0x534afb,_0x1b4f83=_0x3ac698,_0x534afb[_0x36e5ac(0xec)]++,User[_0x36e5ac(0xd3)](_0x534afb);})[_0x5124e1(0xd2)](_0x48cdcd=>{const _0x3d5299=_0x5124e1,_0x51e2a4={...Notification['output'](_0xc22b3c),'sender':User[_0x3d5299(0xc0)](_0x1b4f83)};return _0x44fd00&&_0x44fd00[_0x3d5299(0xd0)]&&_0x4aa5d4[_0x3d5299(0xe2)](CONSTS[_0x3d5299(0xbe)],{'to':_0x44fd00[_0x3d5299(0xd0)],'event':CONSTS[_0x3d5299(0xeb)],'args':{'num':_0x48cdcd[_0x3d5299(0xec)],'notification':_0x51e2a4}}),_0x1f902d[_0x3d5299(0xd4)]({'status':!![],'message':'success','data':_0x51e2a4});});},exports[_0x1e4106(0xd9)]=(_0x5c2a2c,_0x199125)=>{const _0x4bb227=_0x1e4106,{id:_0x21b033}=_0x5c2a2c['params'];return Notification[_0x4bb227(0xd9)](_0x21b033)[_0x4bb227(0xd2)](_0x42d20d=>Promise[_0x4bb227(0xc7)]([_0x42d20d,User[_0x4bb227(0xd9)](_0x42d20d[_0x4bb227(0xdb)]),User[_0x4bb227(0xd9)](_0x42d20d['receiver_id'])]))['then'](([_0x3de335,_0x160182,_0x4d3f0e])=>{const _0x5c8c9e=_0x4bb227;return _0x3de335=Notification[_0x5c8c9e(0xc0)](_0x3de335),_0x199125[_0x5c8c9e(0xd4)]({'status':!![],'message':_0x5c8c9e(0xdf),'data':{..._0x3de335,'sender':User[_0x5c8c9e(0xc0)](_0x160182),'receiver':User[_0x5c8c9e(0xc0)](_0x4d3f0e)}});})['catch'](_0x309942=>respondError(_0x199125,_0x309942));},exports['pagination']=(_0x19d060,_0x1bee89)=>{const _0x36a231=_0x1e4106,{last_id:_0xc2f085,limit:_0x5567a0,sender_id:_0x33d7a3,receiver_id:_0x2da87f}=_0x19d060['body'];let _0x4c610f=[],_0x953f45=0x0,_0x425c9f={},_0x2ff498;return Promise['all']([Notification['paginationByLastId']({'limit':_0x5567a0,'last_id':_0xc2f085,'receiver_id':_0x2da87f}),Notification['getCountOfNotifications']({'receiver_id':_0x2da87f}),Notification['getMinIdtoUser']({'receiver_id':_0x2da87f})])[_0x36a231(0xd2)](([_0x39bf84,_0x32966c,_0x4d2107])=>{const _0x701287=_0x36a231;_0x4c610f=_0x39bf84,_0x953f45=_0x32966c,_0x2ff498=_0x4d2107;let _0x3b5880=[0x0];return _0x39bf84['forEach'](_0x1d6df1=>{const _0x4dcdce=_0x10d6;_0x3b5880['push'](_0x1d6df1[_0x4dcdce(0xdb)]),_0x3b5880[_0x4dcdce(0xdd)](_0x1d6df1['receiver_id']);}),User[_0x701287(0xc5)](_0x3b5880);})[_0x36a231(0xd2)](_0x39dc73=>{const _0x464e55=_0x36a231;_0x39dc73['forEach'](_0x2a893a=>_0x425c9f[_0x2a893a['id']]=_0x2a893a),_0x4c610f=_0x4c610f['map'](_0x2d8b4b=>Notification[_0x464e55(0xc0)](_0x2d8b4b)),_0x4c610f=_0x4c610f[_0x464e55(0xda)](_0x1e472b=>({..._0x1e472b,'sender':User['output'](_0x425c9f[_0x1e472b[_0x464e55(0xdb)]]),'receiver':User[_0x464e55(0xc0)](_0x425c9f[_0x1e472b['receiver_id']])}));const _0x3b726f=_0x4c610f[_0x4c610f['length']-0x1]['id'];return _0x1bee89[_0x464e55(0xd4)]({'status':!![],'message':_0x464e55(0xdf),'data':_0x4c610f,'pager':{'last_id':_0x3b726f,'limit':_0x5567a0,'total':_0x953f45},'hadMore':_0x3b726f>_0x2ff498});})['catch'](_0x348419=>respondError(_0x1bee89,_0x348419));},exports[_0x1e4106(0xed)]=(_0x2b6c2b,_0x656d19)=>{const _0x1e7663=_0x1e4106,{id:_0x6cbe0}=_0x2b6c2b[_0x1e7663(0xe1)];return Notification[_0x1e7663(0xd9)](_0x6cbe0)[_0x1e7663(0xd2)](_0x456226=>{const _0x2c2672=_0x1e7663;let _0xe25efe={};const _0x5c85ac=['id','user_id',_0x2c2672(0xc8),_0x2c2672(0xc6)];return Object['keys'](_0x2b6c2b[_0x2c2672(0xbf)])['forEach'](_0x26fd4b=>{const _0x15174f=_0x2c2672;if(_0x5c85ac[_0x15174f(0xd8)](_0x26fd4b)){}else{if(_0x26fd4b===_0x15174f(0xcc))_0x456226[_0x15174f(0xcc)]=bool2Int(_0x2b6c2b[_0x15174f(0xbf)][_0x15174f(0xcc)]);else _0x456226[_0x26fd4b]!==undefined&&(_0x456226[_0x26fd4b]=_0x2b6c2b[_0x15174f(0xbf)][_0x26fd4b]);}}),Notification[_0x2c2672(0xd3)](_0x456226);})['then'](_0x37f0f3=>_0x656d19[_0x1e7663(0xd4)]({'status':!![],'message':_0x1e7663(0xdf),'data':Notification[_0x1e7663(0xc0)](_0x37f0f3)}))[_0x1e7663(0xde)](_0x3d7dd5=>respondError(_0x656d19,_0x3d7dd5));},exports[_0x1e4106(0xe9)]=(_0x306870,_0x8424ec)=>{const _0x181e22=_0x1e4106;Notification[_0x181e22(0xe9)]()['then'](_0x4854ab=>_0x8424ec[_0x181e22(0xd4)]({'status':!![],'message':_0x181e22(0xdf),'data':_0x4854ab}))[_0x181e22(0xde)](_0x550ee5=>_0x8424ec[_0x181e22(0xe0)](0x1f4)[_0x181e22(0xd4)]({'status':![],'message':_0x550ee5[_0x181e22(0xd7)]||_0x181e22(0xcf)}));},exports['markAsRead']=(_0x2ddd2d,_0x115867)=>{const _0xedf291=_0x1e4106,{id:_0x5b6da0}=_0x2ddd2d['params'];return this[_0xedf291(0xdc)](_0x5b6da0)['then'](_0x2702e1=>{const _0x1da38d=_0xedf291;return _0x115867['json']({'status':!![],'message':_0x1da38d(0xea),'data':Notification[_0x1da38d(0xc0)](_0x2702e1)});})[_0xedf291(0xde)](_0x81b75e=>respondError(_0x115867,_0x81b75e));},exports['markAsReadReq']=_0x2f725b=>{const _0x2ef5a9=_0x1e4106;return Notification[_0x2ef5a9(0xd9)](_0x2f725b)['then'](_0x301b6a=>{return Notification['save']({..._0x301b6a,'is_read':0x1});})[_0x2ef5a9(0xd2)](_0x22b437=>_0x22b437);},exports['markAllAsRead']=(_0x261a9c,_0x152f4a)=>{const _0x375603=_0x1e4106,_0x264a61=_0x261a9c[_0x375603(0xd6)][_0x375603(0xc3)][_0x375603(0xd5)],{uid:_0x339e6e}=getTokenInfo(_0x261a9c);return this[_0x375603(0xe8)]({'user_id':_0x339e6e,'socketClient':_0x264a61})['then'](_0x40fc43=>{const _0x406b8c=_0x375603;return _0x152f4a[_0x406b8c(0xd4)]({'status':!![],'message':'success'});});},exports[_0x1e4106(0xe8)]=async({user_id:_0x392b8a,socketClient:socketClient=null})=>{const _0x36e024=_0x1e4106,_0x18e32a=await User[_0x36e024(0xd9)](_0x392b8a);return Notification['getByUserId'](_0x392b8a)['then'](_0x46edc3=>{const _0x3e9689=_0x36e024;return Promise[_0x3e9689(0xc7)](_0x46edc3['map'](_0x41a41d=>{const _0xda7388=_0x3e9689;return _0x41a41d[_0xda7388(0xc9)]=0x1,Notification[_0xda7388(0xd3)](_0x41a41d);}));})[_0x36e024(0xd2)](_0x24ece4=>{const _0xb72f58=_0x36e024;return socketClient&&_0x18e32a&&_0x18e32a[_0xb72f58(0xd0)]&&socketClient[_0xb72f58(0xe2)](CONSTS[_0xb72f58(0xbe)],{'to':_0x18e32a[_0xb72f58(0xd0)],'event':CONSTS[_0xb72f58(0xeb)],'args':{'num':0x0}}),!![];});},exports[_0x1e4106(0xca)]=async(_0x4497a1,_0x1e977f)=>{const _0x47bb5f=_0x1e4106,_0x5b08a5=_0x4497a1[_0x47bb5f(0xd6)][_0x47bb5f(0xc3)][_0x47bb5f(0xd5)],{uid:_0x1372cf}=getTokenInfo(_0x4497a1);return this[_0x47bb5f(0xe5)]({'user_id':_0x1372cf,'socketClient':_0x5b08a5})[_0x47bb5f(0xd2)](_0xd052e9=>{const _0xc81133=_0x47bb5f;return _0x1e977f[_0xc81133(0xd4)]({'status':!![],'message':'success'});});},exports['deleteAllReq']=async({user_id:_0x341b49,socketClient:_0x4eaa03})=>{const _0x1e594b=_0x1e4106,_0x16e5ef=await User[_0x1e594b(0xd9)](_0x341b49);return Notification['deleteByUserId'](_0x341b49)[_0x1e594b(0xd2)](_0x3f2df5=>{return!![];});},exports[_0x1e4106(0xc2)]=async(_0xd11d33,_0xa5c6f4)=>{const _0x5154ad=_0x1e4106,_0x2d5ef2=_0xd11d33[_0x5154ad(0xd6)]['locals']['socketClient'],{uid:_0xec40a2}=getTokenInfo(_0xd11d33);return this[_0x5154ad(0xd1)]({'user_id':_0xec40a2,'socketClient':_0x2d5ef2,'id':_0xd11d33[_0x5154ad(0xe1)]['id']})[_0x5154ad(0xd2)](_0x484e90=>{const _0x462f1b=_0x5154ad;return _0xa5c6f4[_0x462f1b(0xd4)]({'status':!![],'message':_0x462f1b(0xdf)});});},exports[_0x1e4106(0xd1)]=async({user_id:_0x1ebe90,id:_0x1d6407,socketClient:socketClient=null})=>{const _0x51bbdd=_0x1e4106,_0x1759e1=await User['getById'](_0x1ebe90);return Notification['deleteById'](_0x1ebe90)[_0x51bbdd(0xd2)](_0x1900b2=>Notification['getByUserId'](_0x1ebe90))[_0x51bbdd(0xd2)](_0x54614c=>{const _0x167eb6=_0x51bbdd,_0x5b1638=_0x54614c[_0x167eb6(0xe6)](_0x5c92f6=>_0x5c92f6[_0x167eb6(0xc9)]===0x0);return socketClient&&_0x1759e1&&_0x1759e1['socket_id']&&socketClient[_0x167eb6(0xe2)](CONSTS[_0x167eb6(0xbe)],{'to':_0x1759e1[_0x167eb6(0xd0)],'event':CONSTS['SKT_NOTI_NUM_UPDATED'],'args':{'num':_0x5b1638[_0x167eb6(0xc1)]}}),!![];});};